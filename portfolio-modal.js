// ูุงูุฐุฉ ููุจุซูุฉ ููุนุฑุถ ุงูุฃุนูุงู - ุชุตููู ูุญุณู ูุงุญุชุฑุงูู

// ุจูุงูุงุช ุงููุดุงุฑูุน (ุณูุชู ุชุญุฏูุซูุง ูู ููู portfilo.js)
let portfolioProjects = [];

// ูุชุญ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ููุนุฑุถ ุงูุฃุนูุงู
function openPortfolioModal(projectId) {
    // ุงูุจุญุซ ุนู ุงููุดุฑูุน
    const project = portfolioProjects.find(p => p.id === projectId);
    if (!project) {
        console.error('Project not found:', projectId);
        return;
    }

    // ุฅูุดุงุก ุงููุงูุฐุฉ ุงูููุจุซูุฉ
    const portfolioModal = document.createElement('div');
    portfolioModal.className = 'portfolio-modal';
    portfolioModal.innerHTML = `
        <div class="portfolio-modal-content">
            <div class="portfolio-modal-header">
                <button class="portfolio-modal-close" onclick="closePortfolioModal()">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="portfolio-modal-title">${project.title}</h2>
                <span class="portfolio-modal-category">${project.categoryName || project.category}</span>
                
                <!-- ุดุฑูุท ุงููุนูููุงุช ุงูุณุฑูุนุฉ -->
                <div class="portfolio-quick-stats">
                    <div class="portfolio-stat-item">
                        <span class="portfolio-stat-value">${project.rating || '5.0'}</span>
                        <div class="portfolio-stat-label">โญ ุงูุชูููู</div>
                    </div>
                    <div class="portfolio-stat-item">
                        <span class="portfolio-stat-value">${project.views || '0'}</span>
                        <div class="portfolio-stat-label">๐๏ธ ุงููุดุงูุฏุงุช</div>
                    </div>
                    <div class="portfolio-stat-item">
                        <span class="portfolio-stat-value">${project.deliveryDate || 'ุบูุฑ ูุญุฏุฏ'}</span>
                        <div class="portfolio-stat-label">๐ ูุฏุฉ ุงูุชุณููู</div>
                    </div>
                    <div class="portfolio-stat-item">
                        <span class="portfolio-stat-value">${project.date || 'ุบูุฑ ูุญุฏุฏ'}</span>
                        <div class="portfolio-stat-label">๐ ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ</div>
                    </div>
                </div>
            </div>
            
            <div class="portfolio-modal-body">
                <!-- ุดุฑูุท ุงูุตูุฑ ุงูุฃููู ุงููุญุณู -->
                <div class="portfolio-screenshots">
                    <h3>ูุนุงููุฉ ุงูุนูู</h3>
                    <div class="screenshots-container">
                        ${project.screenshots && project.screenshots.length > 0 ? 
                            project.screenshots.map((screenshot, index) => `
                                <div class="screenshot-item" onclick="openImageViewer('${screenshot}')">
                                    <div class="screenshot-counter">${index + 1}/${project.screenshots.length}</div>
                                    <img src="${screenshot}" alt="ููุทุฉ ุดุงุดุฉ ${index + 1} ูู ุงููุดุฑูุน" loading="lazy" />
                                </div>
                            `).join('') : 
                            `<div style="text-align: center; padding: 40px; color: #666;">
                                <i class="fas fa-image" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                <p>ูุง ุชูุฌุฏ ููุทุงุช ุดุงุดุฉ ูุชุงุญุฉ ููุฐุง ุงููุดุฑูุน</p>
                            </div>`
                        }
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงููุดุฑูุน ุงููุญุณูุฉ -->
                <div class="portfolio-info">
                    <div class="portfolio-info-item">
                        <span class="portfolio-info-icon">โญ</span>
                        <span class="portfolio-info-value">${project.rating || '5.0'}</span>
                        <div class="portfolio-info-label">ุชูููู ุงูุนููุงุก</div>
                    </div>
                    <div class="portfolio-info-item">
                        <span class="portfolio-info-icon">๐๏ธ</span>
                        <span class="portfolio-info-value">${formatNumber(project.views || 0)}</span>
                        <div class="portfolio-info-label">ุนุฏุฏ ุงููุดุงูุฏุงุช</div>
                    </div>
                    <div class="portfolio-info-item">
                        <span class="portfolio-info-icon">๐</span>
                        <span class="portfolio-info-value">${project.deliveryDate || 'ูุชุบูุฑ'}</span>
                        <div class="portfolio-info-label">ูุฏุฉ ุงูุชุณููู</div>
                    </div>
                    <div class="portfolio-info-item">
                        <span class="portfolio-info-icon">๐</span>
                        <span class="portfolio-info-value">${formatDate(project.date) || 'ุบูุฑ ูุญุฏุฏ'}</span>
                        <div class="portfolio-info-label">ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ</div>
                    </div>
                </div>

                <!-- ุงููุตู ุงููุญุณู -->
                <div class="portfolio-description">
                    <h3>ูุตู ุงููุดุฑูุน</h3>
                    <p>${project.detailedDescription || project.description || 'ูุง ููุฌุฏ ูุตู ููุตู ูุชุงุญ ููุฐุง ุงููุดุฑูุน.'}</p>
                    
                    ${project.features && project.features.length > 0 ? `
                        <div class="portfolio-features">
                            <h4>ูุง ูุดููู ูุฐุง ุงูุนูู:</h4>
                            <div class="portfolio-features-list">
                                ${project.features.map(feature => `
                                    <div class="portfolio-feature-item">${feature}</div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>

                <!-- ุฑุฃู ุงูุนููู ุงููุญุณู -->
                <div class="portfolio-client-review">
                    <h3>ุฑุฃู ุงูุนููู</h3>
                    <div class="portfolio-client-review-content">
                        <div class="portfolio-client-review-image">
                            <img src="${project.clientReviewImage || 'https://picsum.photos/300/200?random=' + project.id}" 
                                 alt="ููุทุฉ ุดุงุดุฉ ูู ุฑุฃู ุงูุนููู" loading="lazy" />
                        </div>
                        <div class="portfolio-client-review-text">
                            ${project.clientReview || 'ุนููู ุฑุงุถู ุนู ุฌูุฏุฉ ุงูุฎุฏูุฉ ุงูููุฏูุฉ ูุงูุงูุชุฒุงู ุจุงูููุงุนูุฏ ุงููุญุฏุฏุฉ. ุงูุนูู ุชู ุจูุณุชูู ุงุญุชุฑุงูู ุนุงูู.'}
                        </div>
                    </div>
                </div>

                <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุงููุญุณูุฉ -->
                <div class="portfolio-actions">
                    <a href="https://wa.me/966549225740?text=ุฃุฑูุฏ ุทูุจ ุฎุฏูุฉ ูุดุงุจูุฉ ููุดุฑูุน: ${encodeURIComponent(project.title)}" 
                       class="portfolio-action-btn primary" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                        ุทูุจ ุฎุฏูุฉ ูุดุงุจูุฉ
                    </a>
                    <button class="portfolio-action-btn secondary" onclick="closePortfolioModal()">
                        <i class="fas fa-times"></i>
                        ุฅุบูุงู
                    </button>
                </div>
            </div>
        </div>
    `;

    // ุฅุถุงูุฉ ุงููุงูุฐุฉ ุฅูู ุงูุตูุญุฉ
    document.body.appendChild(portfolioModal);

    // ุฅุธูุงุฑ ุงููุงูุฐุฉ ูุน ุชุฃุซูุฑ ุงูุชูุงูู
    setTimeout(() => {
        portfolioModal.classList.add('show');
    }, 10);

    // ููุน ุงูุชูุฑูุฑ ูู ุงูุฎูููุฉ
    document.body.style.overflow = 'hidden';
    
    // ุชุญุฏูุซ ุนุฏุงุฏ ุงููุดุงูุฏุงุช
    updateProjectViews(projectId);
}

// ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
function closePortfolioModal() {
    const portfolioModal = document.querySelector('.portfolio-modal');
    if (portfolioModal) {
        portfolioModal.classList.remove('show');
        setTimeout(() => {
            portfolioModal.remove();
            document.body.style.overflow = 'auto';
        }, 400);
    }
}

// ูุชุญ ุนุงุฑุถ ุงูุตูุฑ
function openImageViewer(imageSrc) {
    const imageViewer = document.createElement('div');
    imageViewer.className = 'image-viewer';
    imageViewer.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 10002;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    `;
    
    imageViewer.innerHTML = `
        <img src="${imageSrc}" style="max-width: 90%; max-height: 90%; object-fit: contain; border-radius: 10px;" />
        <button onclick="this.parentElement.remove()" style="
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
        ">ร</button>
    `;
    
    imageViewer.onclick = (e) => {
        if (e.target === imageViewer) {
            imageViewer.remove();
        }
    };
    
    document.body.appendChild(imageViewer);
}

// ุชูุณูู ุงูุฃุฑูุงู
function formatNumber(num) {
    if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'k';
    }
    return num.toString();
}

// ุชูุณูู ุงูุชุงุฑูุฎ
function formatDate(dateString) {
    if (!dateString) return null;
    const date = new Date(dateString);
    return date.toLocaleDateString('ar-SA', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

// ุชุญุฏูุซ ุนุฏุงุฏ ุงููุดุงูุฏุงุช
function updateProjectViews(projectId) {
    const project = portfolioProjects.find(p => p.id === projectId);
    if (project) {
        project.views = (project.views || 0) + 1;
    }
}

// ุฅุบูุงู ุงููุงูุฐุฉ ุนูุฏ ุงูููุฑ ุฎุงุฑุฌูุง
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('portfolio-modal')) {
        closePortfolioModal();
    }
});

// ุฅุบูุงู ุงููุงูุฐุฉ ุนูุฏ ุงูุถุบุท ุนูู Escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closePortfolioModal();
    }
});

// ุชุญููู ุจูุงูุงุช ุงููุดุงุฑูุน ูู ููู ุงูุจูุงูุงุช
function loadPortfolioData() {
    // ุณูุชู ุชุญุฏูุซ ูุฐู ุงูุจูุงูุงุช ูู ููู portfilo.js
    if (typeof portfolioData !== 'undefined') {
        portfolioProjects = portfolioData;
    }
}

// ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
document.addEventListener('DOMContentLoaded', function() {
    loadPortfolioData();
});

